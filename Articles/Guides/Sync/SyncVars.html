<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>SyncVars </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="SyncVars ">
    <meta name="generator" content="docfx 2.56.2.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico?v=2">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" style="display:flex;" href="https://github.com/MirageNet/Mirage">
                <img id="logo" class="svg" style="vertical-align: middle;align-self:center;" src="../../../logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="navbar-form-flex">
                  <div class="toggle-mode">
                    <div class="icon">
                    <i aria-hidden="true">🌕</i>
                  </div>
                  <label class="switch">
                    <input type="checkbox" id="switch-style">
                    <span class="slider round"></span>
                  </label>
                  <div class="icon">
                    <i aria-hidden="true">🌙</i>
                  </div>
                    <script type="text/javascript" src="../../../styles/toggle-theme.js"></script>
                  </div>
                  <div class="form-group">
                    <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                  </div>
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="syncvars">SyncVars</h1>

<p>SyncVars are properties of classes that inherit from <a class="xref" href="../../../api/Mirage.NetworkBehaviour.html">NetworkBehaviour</a>, which are synchronized from the server to clients. When a game object is spawned, or a new player joins a game in progress, they are sent the latest state of all SyncVars on networked objects that are visible to them. Use the <a class="xref" href="../../../api/Mirage.SyncVarAttribute.html">[SyncVar]</a> custom attribute to specify which variables in your script you want to synchronize.</p>
<div class="NOTE">
<h5>Note</h5>
<p>The state of SyncVars is applied to game objects on clients before <a class="xref" href="../../../api/Mirage.NetworkIdentity.html#Mirage_NetworkIdentity_OnStartClient">Identity.OnStartClient</a> event is invoked, so the state of the object is always up-to-date in subscribed callbacks.</p>
</div>
<p>SyncVars can use any <a href="../DataTypes.html">type supported by Mirage</a>. You can have up to 64 SyncVars on a single NetworkBehaviour script, including <a href="SyncLists.html">SyncLists</a> and other sync types.</p>
<p>The server automatically sends SyncVar updates when the value of a SyncVar changes, so you do not need to track when they change or send information about the changes yourself. Changing a value in the inspector will not trigger an update.</p>
<div class="NOTE">
<h5>Note</h5>
<p>SyncVars are not sent right away or in the order they are set. They will be sent as a group in the next sync update.</p>
</div>
<h2 id="example">Example</h2>
<p>Let's have a simple <code>Player</code> class with the following code:</p>
<pre><code class="lang-cs">using Mirage;
using UnityEngine;

public class Player : NetworkBehaviour
{
    [SyncVar]
    public int clickCount;

    void Update()
    {
        if (IsLocalPlayer &amp;&amp; Input.GetMouseButtonDown(0))
        {
            ServerRpc_IncreaseClicks();
        }
    }

    [ServerRpc]
    public void ServerRpc_IncreaseClicks()
    {
        // This is executed on the server
        clickCount++;
    }
}
</code></pre>
<p>In this example, when Player A clicks the left mouse button, he sends a <a href="../RemoteCalls/ServerRpc.html">ServerRpc</a> to the server where the <code>clickCount</code> SyncVar is incremented. All other visible players will be informed about Player A's new <code>clickCount</code> value.</p>
<h2 id="class-inheritance">Class inheritance</h2>
<p>SyncVars work with class inheritance. Consider this example:</p>
<pre><code class="lang-cs">class Pet : NetworkBehaviour
{
    [SyncVar] 
    string name;
}

class Cat : Pet
{
    [SyncVar]
    public Color32 color;
}
</code></pre>
<p>You can attach the Cat component to your cat prefab, and it will synchronize both it's <code>name</code> and <code>color</code>.</p>
<div class="WARNING">
<h5>Warning</h5>
<p>Both <code>Cat</code> and <code>Pet</code> should be in the same assembly. If they are in separate assemblies, make sure not to change <code>name</code> from inside <code>Cat</code> directly, add a method to <code>Pet</code> instead.</p>
</div>
<h2 id="syncvar-hook">SyncVar hook</h2>
<p>The <code>hook</code> property of SyncVar can be used to specify a function to be called when the SyncVar changes value on the client and server.</p>
<p><strong>Trivia:</strong></p>
<ul>
<li>The hook callback must have two parameters of the same type as the SyncVar property. One for the old value, one for the new value.</li>
<li>The hook is always called after the SyncVar value is set. You don't need to set it yourself.</li>
<li>The hook only fires for changed values, and changing a value in the inspector will not trigger an update.</li>
<li>Hooks can be virtual methods and overriden in a derived class.</li>
</ul>
<h3 id="example-client-only">Example Client Only</h3>
<p>Below is a simple example of assigning a random color to each player when they're spawned on the server.  All clients will see all players in the correct colors, even if they join later.</p>
<pre><code class="lang-cs">using UnityEngine;
using Mirage;

public class Player : NetworkBehaviour
{
    [SyncVar(hook = nameof(UpdateColor))]
    Color playerColor = Color.black;

    Renderer renderer;

    // Unity makes a clone of the Material every time renderer.material is used.
    // Cache it here and Destroy it in OnDestroy to prevent a memory leak.
    Material cachedMaterial;

    void Awake()
    {
        renderer = GetComponent&lt;Renderer&gt;();
        Identity.OnStartServer.AddListener(OnStartServer);
    }

    void OnStartServer()
    {
        playerColor = Random.ColorHSV(0f, 1f, 1f, 1f, 0.5f, 1f);
    }

    void UpdateColor(Color oldColor, Color newColor)
    {
        // this is executed on this player for each client
        if (cachedMaterial == null)
        {
            cachedMaterial = renderer.material;
        }

        cachedMaterial.color = newColor;
    }

    void OnDestroy()
    {
        Destroy(cachedMaterial);
    }
}
</code></pre>
<h3 id="example-client--server">Example Client &amp; Server</h3>
<p>Below is a simple example of assigning a random color to each player when they're spawned on the server. All clients will see all players in the correct colors, even if they join later.
Server will also fire the event.</p>
<pre><code class="lang-cs">using UnityEngine;
using Mirage;

public class Player : NetworkBehaviour
{
    [SyncVar(hook = nameof(UpdateColor), invokeHookOnServer = true)]
    Color playerColor = Color.black;

    Renderer renderer;

    // Unity makes a clone of the Material every time renderer.material is used.
    // Cache it here and Destroy it in OnDestroy to prevent a memory leak.
    Material cachedMaterial;

    void Awake()
    {
        renderer = GetComponent&lt;Renderer&gt;();
        Identity.OnStartServer.AddListener(OnStartServer);
    }

    void OnStartServer()
    {
        playerColor = Random.ColorHSV(0f, 1f, 1f, 1f, 0.5f, 1f);
    }

    void UpdateColor(Color oldColor, Color newColor)
    {
        // this is executed on this player for each client
        if (cachedMaterial == null)
        {
            cachedMaterial = renderer.material;
        }

        cachedMaterial.color = newColor;
    }

    void OnDestroy()
    {
        Destroy(cachedMaterial);
    }
}
</code></pre>
<h2 id="syncvars-initialize-only">SyncVars Initialize Only</h2>
<p>Just like regular Syncvars, when an game object is spawned, or a new player joins a game in progress, they are sent the latest state of all SyncVars on networked objects that are visible to them.
With the InitialOnly flag set to true you will now be able to control the state of the syncvar manually rather than waiting for Mirage to update them.</p>
<div class="NOTE">
<h5>Note</h5>
<p>Make sure you manually update your observable clients with the new state.
Syncvar Hooks become redundant, as you are setting the state of the Syncvar directly.</p>
</div>
<h3 id="example-1">Example</h3>
<pre><code class="lang-cs">using Mirage;
using UnityEngine;

public class Player : NetworkBehaviour
{
    [SyncVar(initialOnly = true)]
    private int weaponId;

    private void Awake()
    {
        Identity.OnStartClient.AddListener(OnStartClient);
    }
    private void OnStartClient()
    {
        // update weapon using id from syncvar (sent to client via spawn message
        UpdateWeapon(weaponId);
    }

    private void Update()
    {
        if (Input.GetKeyDown(KeyCode.Q))
        {
            // Client Request weapon change
            ServerRpc_SetSyncVarWeaponId(7);
        }
    }

    [ServerRpc]
    private void ServerRpc_SetSyncVarWeaponId(int weaponId)
    {
        // set weapon id on server so new players get it
        this.weaponId = weaponId;

        // tell current players about it
        ClientRpc_SetSyncVarWeaponId(weaponId);

        // update weapon on server
        UpdateWeapon(weaponId);
    }

    [ClientRpc]
    private void ClientRpc_SetSyncVarWeaponId(int weaponId)
    {
        // set id on client
        this.weaponId = weaponId;

        // update weapon on client
        UpdateWeapon(weaponId);
    }

    public void UpdateWeapon(int weaponId)
    {
        // do stuff to update weapon here
        // for example, its spawning model
    }
}
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/MirageNet/Mirage/blob/master/doc/Articles/Guides/Sync/SyncVars.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
