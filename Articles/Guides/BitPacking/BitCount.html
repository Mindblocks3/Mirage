<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Bit Count </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Bit Count ">
    <meta name="generator" content="docfx 2.56.2.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico?v=2">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" style="display:flex;" href="https://github.com/MirageNet/Mirage">
                <img id="logo" class="svg" style="vertical-align: middle;align-self:center;" src="../../../logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="navbar-form-flex">
                  <div class="toggle-mode">
                    <div class="icon">
                    <i aria-hidden="true">🌕</i>
                  </div>
                  <label class="switch">
                    <input type="checkbox" id="switch-style">
                    <span class="slider round"></span>
                  </label>
                  <div class="icon">
                    <i aria-hidden="true">🌙</i>
                  </div>
                    <script type="text/javascript" src="../../../styles/toggle-theme.js"></script>
                  </div>
                  <div class="form-group">
                    <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                  </div>
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="bit-count">Bit Count</h1>

<p>The bit count of Integer based fields can be set using <a class="xref" href="../../../api/Mirage.Serialization.BitCountAttribute.html">BitCountAttribute</a></p>
<p>This will truncate the bits so that only the small bits are sent. There is no range checking for values using BitCount, so value that are too big or negative will not be unpacked correctly</p>
<p>This means that <code>BitCount</code> should not be used with values that can be negative because this data will be lost. If you do need to send negative values then use <a href="ZigZagEncode.html">ZigZagEncode</a> or <a href="BitCountFromRange.html">BitCountFromRange</a></p>
<h3 id="use-cases">Use cases</h3>
<ul>
<li>A Value with a maximum value</li>
<li>An index in an array of known size
<ul>
<li>eg array with 10 elements, index can be sent as 4 bits</li>
</ul>
</li>
<li>A Random int hash where you only need to send 16 bits</li>
</ul>
<h3 id="supported-types">Supported Types</h3>
<ul>
<li>Byte</li>
<li>Short</li>
<li>UShort</li>
<li>Int</li>
<li>Uint</li>
<li>Long</li>
<li>ULong</li>
<li>Enum</li>
</ul>
<h3 id="example-1">Example 1</h3>
<p>Health which is between 0 and 100</p>
<pre><code class="lang-cs">public class MyNetworkBehaviour : NetworkBehaviour 
{
    [SyncVar, BitCount(7)]
    public int Health;
}
</code></pre>
<p><code>BitCount = 7</code> so max value of Health is <code>127</code></p>
<p><code>health = 57</code> will serialize to <code>011_1001</code></p>
<p><code>health = -1</code> <em>(out of range)</em> will serialize to <code>111_1111</code></p>
<p><code>health = 130</code> <em>(out of range)</em> will serialize to <code>000_0010</code></p>
<h3 id="example-2">Example 2</h3>
<p>Weapon index in a list of 6 weapons</p>
<pre><code class="lang-cs">public class MyNetworkBehaviour : NetworkBehaviour 
{
    [SyncVar, BitCount(3)]
    public int WeaponIndex;
}
</code></pre>
<p><code>BitCount = 3</code> so max value of Health is 7</p>
<p><code>WeaponIndex = 5</code> will serialize to <code>101</code></p>
<h3 id="generated-code">Generated Code</h3>
<p>Source:</p>
<pre><code class="lang-cs">[SyncVar, BitCount(7)]
public int myValue;
</code></pre>
<p>Generated:</p>
<pre><code class="lang-cs">public override bool SerializeSyncVars(NetworkWriter writer, bool initialState)
{
    ulong syncVarDirtyBits = base.SyncVarDirtyBits;
    bool result = base.SerializeSyncVars(writer, initialize);

    if (initialState) 
    {
        writer.Write((ulong)this.myValue, 7);
        return true;
    }

    writer.Write(syncVarDirtyBits, 1);
    if ((syncVarDirtyBits &amp; 1UL) != 0UL)
    {
        writer.Write((ulong)this.myValue, 7);
        result = true;
    }

    return result;
}

public override void DeserializeSyncVars(NetworkReader reader, bool initialState)
{
    base.DeserializeSyncVars(reader, initialState);

    if (initialState)
    {
        this.myValue = reader.Read(7);
        return;
    }

    ulong dirtyMask = reader.Read(1);
    if ((dirtyMask &amp; 1UL) != 0UL)
    {
        this.myValue = reader.Read(7);
    }
}
</code></pre>
<p><em>last updated for Mirage v101.8.0</em></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/MirageNet/Mirage/blob/master/doc/Articles/Guides/BitPacking/BitCount.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
